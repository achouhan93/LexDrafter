-- Replace lexdrafter_ with lexdrafter_energy for energy domain

-- Creation Script
CREATE TABLE IF NOT EXISTS public.lexdrafter_document_information (
    id SERIAL UNIQUE,
    celex_id VARCHAR (20) NOT NULL,
	celex_url VARCHAR (100) NOT NULL,
	original_text JSONB,
	annotated_text JSONB,
    PRIMARY KEY (celex_id)
);

CREATE TABLE IF NOT EXISTS public.lexdrafter_definition_term (
	term_id SERIAL NOT NULL,
	doc_id INT REFERENCES lexdrafter_document_information(id),
	term TEXT NOT NULL,
	sentences JSONB,
	PRIMARY KEY (term_id, doc_id)
);

CREATE TABLE IF NOT EXISTS public.lexdrafter_term_explanation (
	id SERIAL NOT NULL,
	term_id INT,
	doc_id INT,
	explanation TEXT,
	PRIMARY KEY (term_id, doc_id),
	FOREIGN KEY (term_id, doc_id) REFERENCES lexdrafter_definition_term(term_id, doc_id)
);

CREATE TABLE IF NOT EXISTS public.lexdrafter_term_relations (
	id SERIAL,
	doc_id INT,
	term_id1 INT,
	term TEXT NOT NULL,
	relationship_id INT REFERENCES lexdrafter_relationship (id),
	PRIMARY KEY (id),
	FOREIGN KEY (doc_id, term_id1) REFERENCES lexdrafter_definition_term(doc_id, term_id)
);

CREATE TABLE IF NOT EXISTS public.lexdrafter_relationship (
	id SMALLINT GENERATED BY DEFAULT AS IDENTITY (CYCLE),
	description VARCHAR NOT NULL UNIQUE,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS public.lexdrafter_progress_table (
	celex_id VARCHAR (20) NOT NULL,
	status TEXT NOT NULL,
    PRIMARY KEY (celex_id)
);

SELECT * FROM lexdrafter_progress_table
INSERT INTO public.lexdrafter_relationship (id, description) VALUES (1, 'is a hyponym of'), (2, 'is a meronym of'), (3, 'are synonyms');

SELECT * FROM lexdrafter_document_information where id = 1
SELECT * FROM lexdrafter_term_explanation where term_id = 3
SELECT * FROM lexdrafter_definition_term
SELECT * FROM lexdrafter_term_relations
SELECT * FROM lexdrafter_document_information

DELETE FROM lexdrafter_progress_table WHERE status = 'definition processed'
DROP TABLE lexdrafter_term_relations
DROP TABLE lexdrafter_term_explanation
DROP TABLE lexdrafter_definition_term
DROP TABLE lexdrafter_document_information


SELECT * FROM lexdrafter_progress_table WHERE status = 'definition processed'

-- Analysis
SELECT term_id, COUNT(*) as count_per_category
FROM lexdrafter_definition_term
GROUP BY term_id
ORDER BY count_per_category DESC;

SELECT * FROM lexdrafter_definition_term
SELECT * FROM lexdrafter_definition_term where term_id = 106

SELECT * FROM lexdrafter_term_explanation where term_id = 106

SELECT * FROM lexdrafter_document_information where celex_id = '32022R0178'

SELECT * FROM lexdrafter_document_information WHERE id = 46
SELECT * FROM lexdrafter_definition_term WHERE term LIKE '%EORI number%';


-- Analysis Queries:
SELECT doc_id, COUNT(term_id) AS term_count
FROM lexdrafter_definition_term
GROUP BY doc_id
ORDER BY term_count ASC;

SELECT * FROM lexdrafter_document_information where id = 3
SELECT * FROM lexdrafter_definition_term where doc_id = 272 and term_id = 2328

SELECT * FROM lexdrafter_term_explanation where doc_id = 272 and term_id = 2328


SELECT term_id, doc_id
FROM lexdrafter_energy_term_explanation
GROUP BY (term_id, doc_id)
ORDER BY term_id ASC, doc_id ASC;

SELECT DISTINCT a.celex_id
FROM lexdrafter_energy_articles a
LEFT JOIN lexdrafter_energy_document_information d ON a.celex_id = d.celex_id
WHERE d.celex_id IS NULL;

SELECT DISTINCT d.celex_id
FROM lexdrafter_energy_document_information d
LEFT JOIN lexdrafter_energy_articles a ON d.celex_id = a.celex_id
WHERE a.celex_id IS NULL;